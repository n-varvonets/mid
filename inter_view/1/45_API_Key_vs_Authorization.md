## API Key vs Authorization

**API Key** и **Authorization** — это два разных механизма контроля доступа в API Gateway, и они служат разным целям.

| **Критерий**             | **API Key**                                         | **Authorization**                                                       |
|--------------------------|-----------------------------------------------------|-------------------------------------------------------------------------|
| **Назначение**           | Отслеживание и контроль использования API           | Управление доступом на основе ролей и прав пользователей                |
| **Аутентификация**       | Не обеспечивает аутентификацию                      | Требует аутентификации пользователя                                     |
| **Управление доступом**  | Не проверяет права доступа                          | Проверяет, есть ли у пользователя разрешение выполнять запрос           |
| **Применение**           | Ограничение частоты запросов и квоты                | Используется для защиты данных и ресурсов на основе прав доступа        |
| **Пример использования** | API для подписчиков, требующий ограничение запросов | Доступ к защищенным ресурсам или действиям, требующий токенов или ролей |
| **Безопасность**         | Низкий уровень безопасности                         | Высокий уровень безопасности через проверку прав доступа                |

### 1. API Key

- **API Key** — это простой уникальный ключ, который передается с запросом для идентификации приложения или клиента,
  использующего API.
- **API Key** используется для **отслеживания и контроля использования** API, а не для аутентификации или авторизации.
- Этот ключ помогает API Gateway определить, кто использует API, и может быть использован для применения квот и
  ограничений на количество запросов (throttling).
- **Безопасность:** API Key сам по себе **не является безопасным механизмом аутентификации**, так как он может быть
  скомпрометирован, если его не защитить надлежащим образом.
- API Key часто требуется для подписчиков или платных API, чтобы ограничить доступ на основе использования.

#### Что будет, если злоумышленник перехватит API Key?

- Если злоумышленник перехватит **API Key**, он сможет **повторно использовать** его для выполнения запросов от имени
  легитимного клиента.
- Это может привести к несанкционированному использованию API, что может повлиять на квоты использования, привести к
  утечке данных или нарушить работу API.

#### Как защитить API Key?

- **Передача по HTTPS:** Всегда используйте HTTPS для передачи API Key, чтобы зашифровать трафик и предотвратить его
  перехват.
- **Ограничение IP-адресов:** Ограни́чьте использование API Key только с определённых IP-адресов.
- **Регулярная ротация ключей:** Регулярно обновляйте API Key и деактивируйте старые ключи.
- **Ограничение прав:** Ограничьте доступ, предоставляемый API Key, до минимально необходимого уровня для предотвращения
  злоупотреблений.
- ## API Key передаётся в заголовке HTTP-запроса через HTTPS, то он будет зашифрован на транспортном уровне благодаря протоколу TLS (Transport Layer Security).

### Пример передачи API Key:

```plaintext
GET /api/v1/resource HTTP/1.1
Host: api.example.com
API-Key: abc123xyz
```

- В этом примере API Key передается как заголовок в HTTP-запросе.

### 2. Authorization

- **Authorization** — это процесс, который определяет, **имеет ли пользователь право** выполнить определённый запрос (
  например, доступ к ресурсу или выполнение действия).
- В API Gateway Authorization может быть настроена с использованием разных методов:
    - **IAM Roles:** Доступ к API предоставляется на основе IAM ролей, которые позволяют управлять доступом к ресурсам
      AWS.
    - **Cognito User Pools:** Для управления доступом на основе OAuth 2.0 и JWT-токенов.
    - **Custom Authorizer:** Пользовательские авторизаторы на основе Lambda-функций, которые проверяют токены или другие
      параметры.
- **Безопасность:** Authorization предоставляет **высокий уровень безопасности**, поскольку требует аутентификации
  пользователя с последующей проверкой его прав доступа.

### Основные различия:

- **API Key** контролирует **использование** API, но не предоставляет возможности аутентификации или проверки прав
  доступа.
- **Authorization** управляет тем, **какие пользователи или роли** имеют доступ к API и могут выполнять запросы на
  основе их прав и токенов.

### Советы по защите:

Для повышения безопасности рекомендуется использовать **API Key** в сочетании с механизмом **Authorization**, чтобы
обеспечить как контроль использования, так и защиту данных и ресурсов.
