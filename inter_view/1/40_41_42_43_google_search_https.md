# Что происходит, когда нажимаешь на кнопку поиска в Google?

Когда вы нажимаете на кнопку поиска в Google, ваш запрос проходит через несколько этапов, чтобы вернуть вам результаты
поиска. Расширим объяснение, чтобы затронуть работу DNS, модель OSI, а также процесс шифрования и дешифрования при
использовании HTTPS.

## Полный процесс нажатия кнопки поиска в Google

### 1. Ввод и отправка запроса

- **Ввод запроса**: Вы вводите поисковый запрос в поисковую строку Google.
- **Отправка запроса**: Нажатие на кнопку отправляет ваш запрос на сервер Google через HTTP или HTTPS.

### 2. DNS-резолвинг (Domain Name System)

DNS (система доменных имён) служит для преобразования доменных имён, таких как `google.com`, в IP-адреса, которые
используют устройства для связи.

#### Где находится DNS?

DNS-серверы размещаются по всему миру. Их можно разделить на несколько категорий:

1. **Резолверы (DNS Resolver)**:
    - Эти серверы чаще всего используются для обработки запросов конечных пользователей.
    - Они могут находиться на стороне интернет-провайдера (ISP) или быть независимыми, например, как публичные резолверы
      Google (`8.8.8.8`), Cloudflare (`1.1.1.1`) или OpenDNS.
    - Когда вы запрашиваете сайт, ваш компьютер отправляет запрос на ближайший DNS-резолвер для разрешения доменного
      имени в IP-адрес.

2. **Корневые DNS-серверы**:
    - Всего в мире существует 13 корневых серверов, но они имеют сотни копий, чтобы обеспечить отказоустойчивость и
      быструю реакцию.
    - Корневые серверы содержат информацию о серверах верхнего уровня (например, `.com`, `.org` и т.д.).

3. **Серверы верхнего уровня (TLD)**:
    - Управляют доменными зонами верхнего уровня, такими как `.com`, `.net`, `.org`.
    - Они хранят информацию о том, на каких авторитетных серверах находятся конкретные домены.

4. **Авторитетные DNS-серверы**:
    - Эти серверы отвечают на запросы о конкретных доменах.
    - Например, если вам нужно найти IP-адрес для `example.com`, запрос в конечном итоге попадает на авторитетный
      DNS-сервер, ответственный за `example.com`.

#### Как роутер участвует в DNS-запросах?

Роутер играет ключевую роль в процессе отправки и маршрутизации DNS-запросов:

1. **Начало запроса**:
    - Когда вы вводите адрес веб-сайта в браузере, ваш компьютер начинает отправку DNS-запроса. Этот запрос должен
      попасть на DNS-сервер для разрешения доменного имени в IP-адрес.

2. **Роль роутера**:
    - **Маршрутизация запроса**: Ваш компьютер обычно настроен на использование определенного DNS-сервера, и роутер
      является первым звеном в передаче запроса к этому серверу.
    - **DNS-кэширование**: Многие домашние роутеры имеют встроенный DNS-кэш. Это означает, что если какой-то доменный
      адрес недавно запрашивался, роутер может хранить его результат в кэше и сразу предоставить его, избегая
      необходимости посылать запрос в интернет.
    - **Переадресация на провайдера**: Если роутер не имеет нужной информации в кэше, он перенаправляет запрос на
      DNS-сервер вашего интернет-провайдера (ISP). Этот сервер уже ищет информацию в своей базе данных или пересылает
      запрос дальше в иерархии DNS.

3. **Получение ответа**:
    - Когда запрос достигает нужного DNS-сервера и получает IP-адрес, этот ответ возвращается по тому же пути: сначала
      на DNS-сервер интернет-провайдера (если он был задействован), затем на роутер, и в конечном итоге - на ваш
      компьютер.
    - **Кэширование**: И роутер, и компьютер могут сохранить результат этого разрешения в кэше, чтобы при повторном
      запросе того же сайта обработка происходила быстрее.

### 3. Установка соединения (модель OSI)

Чтобы лучше понять, как данные передаются между компьютером и сервером, давайте кратко разберем модель OSI (Open Systems
Interconnection).

#### Модель OSI (7 уровней):

1. **Физический уровень**: Физическая передача битов по кабелям или радиосигналу.
2. **Канальный уровень**: Организация передачи данных между соседними узлами.
3. **Сетевой уровень**: Определяет маршрутизацию данных (например, IP-адреса).
4. **Транспортный уровень**: Управляет передачей данных между хостами (например, TCP, UDP).
5. **Сеансовый уровень**: Управляет сессиями и соединениями между приложениями.
6. **Уровень представления**: Преобразование данных в формат, понятный приложению.
7. **Прикладной уровень**: Определяет взаимодействие с пользователем (например, HTTP/HTTPS).

Когда вы нажимаете кнопку поиска:

- Запрос проходит через уровни от **прикладного** до **физического** и обратно.
- На **сетевом уровне** определяется маршрут от вашего устройства к серверу Google с использованием IP-адреса.
- На **транспортном уровне** устанавливается соединение (TCP) для надежной передачи данных.

### 4. HTTP и HTTPS: шифрование и дешифрование

#### Разница между HTTP и HTTPS

- **HTTP (HyperText Transfer Protocol)**: Обычный текст передается между клиентом и сервером. Он уязвим для атак типа "
  человек посередине", так как все данные можно легко перехватить.
- **HTTPS (HyperText Transfer Protocol Secure)**: Использует **шифрование с помощью TLS/SSL** для защиты данных,
  передаваемых между браузером и сервером.

#### Как работает HTTPS?

1. **Установка TLS-соединения (рукопожатие)**:
    - Браузер отправляет серверу запрос для установления защищенного соединения.
    - Сервер отвечает сертификатом безопасности, который содержит его **публичный ключ**.
    - Браузер проверяет сертификат на подлинность с помощью **сертификационного центра (CA)**.
    - Если сертификат подлинный, браузер генерирует **сеансовый ключ** и шифрует его с помощью публичного ключа сервера.
    - Сервер использует свой **частный ключ**, чтобы расшифровать сеансовый ключ.


2. **Шифрование данных**:
    - После установки соединения данные между браузером и сервером шифруются с использованием сеансового ключа.
    - Этот ключ используется для симметричного шифрования, так как он быстрее в вычислениях и более эффективен для
      больших объемов данных.

#### Пример обычного и зашифрованного запроса

##### Пример обычного HTTP-запроса

```plaintext
GET /search?q=openai HTTP/1.1
Host: google.com
User-Agent: Mozilla/5.0
```

- **Безопасность**: Этот запрос отправляется в открытом виде. Любой, кто перехватит этот запрос, может увидеть введённый
  вами текст (`q=openai`) и данные о вашем устройстве (`User-Agent`).

##### Пример зашифрованного HTTPS-запроса

```plaintext
GET /search?q=openai HTTP/1.1
Host: google.com
User-Agent: Mozilla/5.0
```

- **Шифрование**: Сам запрос шифруется, и если его перехватят, злоумышленник увидит только зашифрованные данные, которые
  невозможно легко расшифровать без сеансового ключа.
- **Преимущества безопасности**:
    - **Конфиденциальность**: Данные шифруются, чтобы никто не мог прочитать их содержание.
    - **Целостность**: Шифрование и контроль целостности данных защищают их от изменения при передаче.
    - **Подлинность**: Сертификаты безопасности подтверждают, что соединение установлено с подлинным сервером.

### 5. Обработка запроса сервером

- **Обработка на стороне Google**: Серверы Google принимают запрос, распознают поисковую строку и ищут подходящие
  результаты в своем индексе.
- **Ранжирование**: Google использует сложные алгоритмы для определения, какие результаты наиболее релевантны.
- **Генерация страницы результатов**: На основе индекса и алгоритмов формируется страница с результатами поиска, которая
  затем возвращается браузеру.

### 6. Возвращение результата

- **Ответ сервера**: Сервер возвращает сформированную страницу с результатами поиска вашему браузеру.
- **Отображение результатов**: Браузер получает ответ и отображает результаты на экране пользователя.

## 7. Что известно злоумышленнику при перехвате

- **IP-адреса**: Злоумышленник может увидеть **IP-адрес отправителя и получателя**. Это можно использовать для анализа
  того, с кем общается пользователь, но без доступа к содержимому.
- **Размер данных**: Он также может определить, какой объём данных передаётся, но не их содержимое.

## Заключение

- Если злоумышленник перехватит зашифрованный запрос и попытается его отправить заново, сервер не обработает этот
  запрос.
- Это происходит из-за отсутствия сеансового ключа, уникальности идентификаторов сессии, и встроенных механизмов защиты
  от повторной отправки запросов.
- **HTTPS обеспечивает защиту не только от перехвата и чтения данных, но и от их повторного использования** без
  разрешения клиента и сервера, что делает его надёжным инструментом для безопасной передачи данных в интернете.
- Использование HTTPS вместо HTTP обеспечивает безопасность данных, передаваемых между клиентом и сервером, за счёт
  шифрования. Это особенно важно при работе с личными данными или финансовыми транзакциями. Модель OSI помогает лучше
  понять, как данные проходят через различные уровни, начиная от физического и заканчивая прикладным. Роутер также
  играет
  важную роль в маршрутизации запросов и взаимодействии с DNS, что позволяет осуществлять быструю и эффективную передачу
  данных.
