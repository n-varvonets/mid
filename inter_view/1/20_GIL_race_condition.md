
# Что такое состояние гонки?

**Состояние гонки** (Race Condition) — это ошибка в многопоточном или многопроцессном программировании, которая возникает, когда несколько потоков или процессов одновременно пытаются изменить одни и те же данные, и порядок выполнения этих потоков или процессов не определён.

## Пример состояния гонки:
Предположим, что у нас есть общий счётчик, и два потока пытаются увеличить его значение одновременно.

```python
counter = 0

def increment():
    global counter
    for _ in range(100000):
        counter += 1

# Запуск двух потоков
import threading
t1 = threading.Thread(target=increment)
t2 = threading.Thread(target=increment)

t1.start()
t2.start()

t1.join()
t2.join()

print(counter)  # Ожидаемое значение 200000, но результат может быть меньше

# Если два потока одновременно выполняют эту операцию, может произойти так, что оба потока
# сначала прочтут одно и то же значение, увеличат его и запишут одинаковый результат,
# что приводит к потере одного из увеличений.

```

### Почему возникает состояние гонки:
- **Неопределённый порядок выполнения**: Операция увеличения `counter += 1` на самом деле состоит из нескольких шагов: чтение текущего значения, увеличение на 1 и запись нового значения обратно в память.
- Если два потока одновременно выполняют эту операцию, может произойти так, что оба потока сначала прочтут одно и то же значение, увеличат его и запишут одинаковый результат, что приводит к потере одного из увеличений.

### Почему это проблема:
- В результате последовательность действий может быть некорректной, и итоговое значение переменной будет меньше ожидаемого.

## Связь с GIL:
- **GIL (Global Interpreter Lock)** в Python предотвращает возникновение состояний гонки в многопоточном программировании, защищая внутренние структуры данных Python, такие как ссылки на объекты и счетчики ссылок. GIL делает так, что в каждый момент времени только один поток может выполнять байт-код Python, что упрощает работу с памятью, но ограничивает параллелизм на уровне потоков.
