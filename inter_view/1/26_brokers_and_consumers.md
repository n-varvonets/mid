
# Брокеры сообщений и Консьюмеры

## Названия брокеров сообщений (Message Brokers):

1. **RabbitMQ**: Популярный брокер сообщений, который работает с очередями и обменниками для передачи данных между сервисами.
2. **Apache Kafka**: Распространённый брокер сообщений, который специализируется на обработке больших потоков данных.
3. **Amazon SQS**: Очередь сообщений от AWS, облачное решение для асинхронного взаимодействия.
4. **ActiveMQ**: Ветеран среди брокеров сообщений, используется для асинхронного обмена данными между системами.
5. **Redis Pub/Sub**: Система обмена сообщениями, построенная на основе базы данных Redis.
6. **NATS**: Лёгкий брокер сообщений, созданный для высокой производительности и низкой задержки.

## Названия консьюмеров (Consumers):

Консьюмеры — это не программные продукты, а конкретные микросервисы или программы, которые ты разрабатываешь, чтобы забирать сообщения из брокеров.

### Примеры:
- **Сервис платежей** может быть консьюмером для очереди заказов.
- **Сервис уведомлений** — консьюмер для сообщений об отправке уведомлений.

## Как консьюмер понимает, что нужно забрать сообщение?

Консьюмеры **подписываются** на очередь в брокере сообщений. После подписки:
1. Брокер сообщений (например, RabbitMQ или Kafka) кладёт сообщение в очередь.
2. Консьюмер постоянно проверяет очередь или получает сообщение, как только оно появляется.
3. Консьюмер забирает сообщение и выполняет задачу (например, обрабатывает заказ или отправляет уведомление).

## Apache Kafka: брокер и консьюмер?

**Apache Kafka** — это **брокер сообщений**. Он предоставляет систему очередей и хранилище сообщений для обработки больших потоков данных. Однако Kafka **не является консьюмером**.

### В Kafka:
- **Kafka Broker** управляет очередями и распределением сообщений между продюсерами и консьюмерами.
- **Kafka Consumer** — это программа или микросервис, который подписывается на топики (разделы очередей в Kafka) и забирает сообщения для обработки.

Таким образом, Kafka — это **брокер** сообщений, а **консьюмеры** — это отдельные программы или сервисы, которые взаимодействуют с Kafka для получения данных.



# Пример для RabbitMQ

## Установка библиотеки:

```bash
pip install pika
```

## Пример кода для консьюмера:

```python
import pika

# Устанавливаем соединение с RabbitMQ
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Подписываемся на очередь 'task_queue'
channel.queue_declare(queue='task_queue', durable=True)

# Функция для обработки сообщений
def callback(ch, method, properties, body):
    print(f"[x] Получено сообщение: {body.decode()}")
    # Имитация обработки задачи
    ch.basic_ack(delivery_tag=method.delivery_tag)  # Подтверждаем, что задача выполнена

# Подписываемся на очередь и начинаем получать сообщения
channel.basic_qos(prefetch_count=1)  # Гарантия, что консьюмер получит только 1 сообщение за раз
channel.basic_consume(queue='task_queue', on_message_callback=callback)

print(' [*] Ожидание сообщений. Для выхода нажмите CTRL+C')
channel.start_consuming()
```

## Как это работает:

1. **Подключение**: Консьюмер устанавливает соединение с RabbitMQ.
2. **Подписка на очередь**: Консьюмер подписывается на очередь `task_queue`.
3. **Обработка сообщений**: Каждый раз, когда новое сообщение попадает в очередь, RabbitMQ передаёт его консьюмеру, который вызывает функцию `callback` для обработки.
4. **Подтверждение**: После обработки сообщения вызывается `ch.basic_ack`, что подтверждает успешное завершение обработки.
