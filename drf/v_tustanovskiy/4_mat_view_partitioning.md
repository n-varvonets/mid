## Что такое материализованное представление (Materialized View)?

**Материализованное представление** (Materialized View) — это объект базы данных, который хранит результаты запроса в виде физической таблицы. В отличие от обычных представлений (views), которые вычисляются на лету каждый раз при запросе, материализованное представление сохраняет данные и позволяет обращаться к ним без повторного выполнения исходного запроса.

### Отличия от обычной таблицы:

1. **Обычная таблица**:
   - Хранит "сырые" данные, которые добавляются, изменяются или удаляются напрямую.
   - Не зависит от других таблиц или сложных запросов.
   - Требует постоянного обновления вручную при изменении данных.

2. **Материализованное представление**:
   - Хранит результат **запроса** (например, агрегации или сложных объединений из нескольких таблиц).
   - Данные не обновляются автоматически — требуется **обновление вручную** (через `REFRESH MATERIALIZED VIEW`) или по расписанию.
   - Полезно для **оптимизации производительности**, когда результат сложного запроса нужно получать часто, но данные изменяются не очень часто.

### Пример использования:

Предположим, у вас есть сложный запрос, который объединяет несколько таблиц и выполняет агрегированные вычисления (например, подсчет количества заказов для каждого пользователя). Этот запрос может быть ресурсозатратным, если его выполнять каждый раз, когда нужно отобразить данные. Вместо этого можно создать материализованное представление, которое будет хранить результат этого запроса, и обращаться к нему, как к обычной таблице.

```sql
CREATE MATERIALIZED VIEW user_orders_summary AS
SELECT
    user_id,
    COUNT(order_id) AS total_orders,
    SUM(order_amount) AS total_spent
FROM orders
GROUP BY user_id;
```
## Материализованное представление (Materialized View)

Теперь вы можете выполнять запросы к этому материализованному представлению:

```sql
SELECT * FROM user_orders_summary;
```
В отличие от обычной таблицы, вам нужно вручную обновлять данные в материализованном представлении, когда изменяются исходные таблицы:

```sql
REFRESH MATERIALIZED VIEW user_orders_summary;
```
## В чем преимущества?

- **Ускорение запросов**: Если у вас есть сложные запросы, которые часто выполняются, но исходные данные не меняются слишком часто, материализованное представление позволяет сократить время обработки, так как результат запроса уже сохранен.

- **Оптимизация производительности**: Для аналитики и отчетов, где важно получать данные быстро, но обновления происходят реже, материализованное представление значительно снижает нагрузку на базу данных.

- **Удобство использования**: Материализованное представление можно использовать так же, как обычную таблицу. Это упрощает написание сложных запросов и их дальнейшее использование в системе.

## Когда применять?

- **Часто используемые сложные запросы**: Если вы часто выполняете тяжелые запросы с агрегированными данными или сложными соединениями, но данные меняются редко, материализованное представление позволит вам ускорить получение результатов.

- **Аналитика**: В отчетных системах и аналитике, где данные нужно обновлять периодически (например, раз в день), материализованное представление может сильно ускорить доступ к результатам.

- **Кэширование**: Когда результат сложного запроса служит временным кэшем данных для ускорения работы приложения.

## Недостатки:

- **Неавтоматическое обновление**: Данные в материализованном представлении нужно обновлять вручную или по расписанию (например, с помощью `cron`), что делает его менее динамичным, чем обычные таблицы или представления.

- **Дополнительное хранилище**: Материализованное представление занимает место в базе данных, так как хранит копию данных, что может увеличить использование дискового пространства.

## Вывод:

Материализованное представление полезно для ускорения сложных запросов, которые выполняются часто, но данные меняются не слишком часто. Оно сохраняет результат запроса в виде таблицы и требует ручного обновления. Применять его стоит для аналитических и отчетных задач, кэширования данных или ускорения производительности в больших базах данных.

---

## Что такое порционирование?

**Порционирование** (Partitioning) — это метод разделения больших таблиц на более мелкие, управляемые сегменты (разделы), для улучшения производительности базы данных и упрощения управления данными. Каждый раздел представляет собой независимый объект, но логически связан с исходной таблицей.

### Зачем нужно порционирование?

1. **Ускорение запросов**:
   - Улучшает производительность запросов, особенно для больших таблиц, так как запросы могут выполняться только над нужными разделами таблицы.
   
2. **Упрощение управления данными**:
   - Упрощает работу с большими таблицами — можно управлять данными по отдельным разделам (например, удалять старые данные).

3. **Оптимизация хранения**:
   - Позволяет распределять разделы по разным дисковым хранилищам для оптимизации производительности и использования места.

### Виды порционирования:

1. **Диапазон (Range Partitioning)**:
   - Разделение по диапазону значений (например, по дате или диапазону идентификаторов).

2. **Список (List Partitioning)**:
   - Разделение по предопределенному списку значений (например, по регионам или категориям).

3. **Хэш (Hash Partitioning)**:
   - Разделение на основе хэш-функции (например, для равномерного распределения данных).

4. **Составное (Composite Partitioning)**:
   - Комбинированное порционирование (например, диапазон + хэш).

### Пример использования:

```sql
CREATE TABLE orders (
    order_id INT,
    order_date DATE,
    customer_id INT,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (order_date)(
    PARTITION p0 VALUES LESS THAN ('2021-01-01'),
    PARTITION p1 VALUES LESS THAN ('2022-01-01'),
    PARTITION p2 VALUES LESS THAN ('2023-01-01')
);
```
## Преимущества порционирования таблиц:

1. **Ускорение запросов**:
   - Порционирование позволяет быстрее обрабатывать запросы, так как данные разделяются на части, и запросы могут работать только с нужными порциями.

2. **Уменьшение блокировок**:
   - Порционирование снижает вероятность блокировок в базе данных, так как операции выполняются на отдельных частях таблицы, а не на всей таблице.

3. **Эффективное управление данными**:
   - Упрощает управление большими объемами данных, особенно если нужно работать с историческими или архивными данными.

## Когда использовать порционирование?

- Для работы с большими таблицами, которые содержат миллионы или миллиарды строк.
- При необходимости оптимизировать запросы и управлять историческими данными.
- Когда важно уменьшить нагрузку на базу данных и повысить производительность операций.

### Вывод:

Порционирование помогает улучшить производительность базы данных, уменьшить время выполнения запросов и эффективно управлять большими объемами данных.
